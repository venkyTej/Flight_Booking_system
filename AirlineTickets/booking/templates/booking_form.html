{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4 text-center">Book Your Flight Ticket</h2>

    <form method="post">
        {% csrf_token %}
        <div class="row">
            <!-- Passenger Information -->
            <div class="col-md-6">
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-info text-white">
                        Passenger Information
                    </div>
                    <div class="card-body">
                        <div class="form-group mb-3">
                            <label for="id_passenger_name">Passenger Name:</label>
                            {{ form.passenger_name }}
                        </div>
                        <div class="form-group mb-3">
                            <label for="id_aadhar_number">Aadhar Number:</label>
                            {{ form.aadhar_number }}
                        </div>
                        <div class="form-group mb-3">
                            <label for="id_contact_number">Contact Number:</label>
                            {{ form.contact_number }}
                        </div>
                        <div class="form-group mb-3">
                            <label for="id_email">Email:</label>
                            {{ form.email }}
                        </div>
                        <div class="form-group mb-3">
                            <label for="id_num_seats">Number of Seats:</label>
                            {{ form.num_seats }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Flight Information -->
            <div class="col-md-6">
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-primary text-white">
                        Flight Information
                    </div>
                    <div class="card-body">
                        <div class="form-group mb-3">
                            <label for="id_flight">Select Flight:</label>
                            {{ form.flight }}
                        </div>

                        <!-- Arrival -->
                        <div class="form-group mb-3">
                            <label for="arrival">Arrival:</label>
                            <input type="text" id="arrival" class="form-control" readonly>
                            <input type="hidden" name="arrival" id="arrival_hidden">
                        </div>

                        <!-- Departure -->
                        <div class="form-group mb-3">
                            <label for="departure">Departure:</label>
                            <input type="text" id="departure" class="form-control" readonly>
                            <input type="hidden" name="departure" id="departure_hidden">
                        </div>

                        <!-- Flight Price (Per Seat) -->
                        <div class="form-group mb-3">
                            <label for="flight_price">Flight Price (per seat):</label>
                            <input type="text" id="flight_price" class="form-control" readonly>
                            <input type="hidden" name="flight_price" id="flight_price_hidden">
                        </div>

                        <!-- Total Price -->
                        <div class="form-group mb-3">
                            <label for="total_price">Total Price:</label>
                            <input type="text" id="total_price" class="form-control" readonly>
                            <input type="hidden" name="total_price" id="total_price_hidden">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit -->
        <div class="text-center mt-4">
            <button type="submit" class="btn btn-success btn-lg">Confirm Booking</button>
        </div>
    </form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const flightSelect = document.getElementById("id_flight");
        const numSeatsInput = document.getElementById("id_num_seats");
        const arrivalInput = document.getElementById("arrival");
        const arrivalHidden = document.getElementById("arrival_hidden");
        const departureInput = document.getElementById("departure");
        const departureHidden = document.getElementById("departure_hidden");
        const flightPriceInput = document.getElementById("flight_price");
        const flightPriceHidden = document.getElementById("flight_price_hidden");
        const totalPriceInput = document.getElementById("total_price");
        const totalPriceHidden = document.getElementById("total_price_hidden");

        const flightData = {
            {% for flight in flights %}
                "{{ flight.id }}": {
                    arrival: "{{ flight.arrival_place|escapejs }}",
                    departure: "{{ flight.departure_place|escapejs }}",
                    price: "{{ flight.price }}"
                }{% if not forloop.last %},{% endif %}
            {% endfor %}
        };

        function updateFlightDetails() {
            const selectedFlightId = flightSelect.value;
            const data = flightData[selectedFlightId];
            console.log(data)
            if (data) {
                arrivalInput.value = data.arrival;
                arrivalHidden.value = data.arrival;

                departureInput.value = data.departure;
                departureHidden.value = data.departure;

                flightPriceInput.value = data.price;
                flightPriceHidden.value = data.price;
            } else {
                arrivalInput.value = "";
                arrivalHidden.value = "";

                departureInput.value = "";
                departureHidden.value = "";

                flightPriceInput.value = "";
                flightPriceHidden.value = "";
            }
            updateTotalPrice();
        }

        function updateTotalPrice() {
            const selectedFlightId = flightSelect.value;
            const data = flightData[selectedFlightId];
            const numSeats = parseInt(numSeatsInput.value) || 1;

            if (data) {
                const pricePerSeat = parseFloat(data.price);
                const total = pricePerSeat * numSeats;
                totalPriceInput.value = total.toFixed(2);
                totalPriceHidden.value = total.toFixed(2);
            } else {
                totalPriceInput.value = "";
                totalPriceHidden.value = "";
            }
        }

        flightSelect.addEventListener("change", updateFlightDetails);
        numSeatsInput.addEventListener("input", updateTotalPrice);

        updateFlightDetails();  // initialize values on page load
    });
</script>
{% endblock %}
